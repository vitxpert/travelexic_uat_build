"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1820],{1820:(L,h,a)=>{a.r(h),a.d(h,{ChatScreenPageModule:()=>N});var p=a(6895),c=a(4006),r=a(8058),d=a(3317),l=a(655),e=a(8256),u=a(1692);let f=(()=>{class n{constructor(t){this.globalService=t}ngOnInit(){console.log(this.message)}share(){return(0,l.mG)(this,void 0,void 0,function*(){})}download(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.globalService.downloadImage(this.message.attachment)})}view(){return(0,l.mG)(this,void 0,void 0,function*(){window.open(this.message.attachment,"_blank")})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-popover"]],decls:5,vars:0,consts:[[3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-list")(1,"ion-item",0),e.NdJ("click",function(){return o.view()}),e._uU(2,"View"),e.qZA(),e.TgZ(3,"ion-item",0),e.NdJ("click",function(){return o.download()}),e._uU(4,"Download"),e.qZA()())},dependencies:[r.Ie,r.q_]}),n})();function v(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"ion-item",4),e.NdJ("click",function(){const g=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.selectUser(g))}),e._UZ(1,"ion-icon",5),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()}if(2&n){const t=s.$implicit;e.xp6(3),e.Oqu(null==t?null:t.chat_name)}}let C=(()=>{class n{constructor(t){this.modalController=t}ngOnInit(){}selectUser(t){return(0,l.mG)(this,void 0,void 0,function*(){yield this.modalController.dismiss(t,"accept")})}closeModal(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.modalController.dismiss(null,"cancel")})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.IN))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-users-list"]],inputs:{items:"items"},decls:8,vars:1,consts:[[2,"padding","20px","padding-top","0px"],[2,"text-align","right"],["name","close-circle-outline",1,"close-icon",3,"click"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["name","person-circle-outline"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"ion-icon",2),e.NdJ("click",function(){return o.closeModal()}),e.qZA()(),e.TgZ(3,"h5"),e._uU(4,"Select Recipient"),e.qZA(),e.TgZ(5,"ion-content")(6,"ion-list"),e.YNc(7,v,4,1,"ion-item",3),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("ngForOf",o.items))},dependencies:[p.sg,r.W2,r.gu,r.Ie,r.Q$,r.q_],styles:["ion-item[_ngcontent-%COMP%]::part(native){border:1px #888888 solid;border-width:1px;padding:0 0 0 5px;border-radius:5px}ion-item[_ngcontent-%COMP%]{margin-bottom:10px;border-bottom:0px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding-left:5px}.close-icon[_ngcontent-%COMP%]{font-size:20px;margin-top:10px}h5[_ngcontent-%COMP%]{margin-top:0;padding-top:0;color:#00008b}ion-content[_ngcontent-%COMP%]{min-height:450px}"]}),n})();var _=a(2340),b=a(529),P=a(1228);let x=(()=>{class n{constructor(t,o){this.http=t,this.auth=o,this.pusher=new Pusher(_.N.pusher.key,{cluster:_.N.pusher.cluster,encrypted:!1,channelAuthorization:{endpoint:"https://tcchat.travelexic.com/api/auth"}}),this.channel=this.pusher.subscribe("private-trvl_chat"),this.pusher.connection.bind("error",function(i){console.log(i)})}sendMessage(t){this.channel.trigger("client-messaging",t)}typingMessage(t){}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(b.eN),e.LFG(P.e))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var y=a(6775);function M(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._UZ(3,"br"),e.BQk()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.hij("",t.sender_name," ")}}function S(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"img",15),e.NdJ("click",function(i){e.CHM(t);const g=e.oxw().$implicit,m=e.oxw();return e.KtG(m.presentPopover(i,g))}),e.qZA()()}if(2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("src",t.attachment,e.LSH)}}const w=function(n,s){return{"my-message":n,"other-message":s}},k=function(n,s,t){return{"bg-color-blue":n,"bg-color-red":s,"bg-color-white":t}};function Z(n,s){if(1&n&&(e.TgZ(0,"div",11)(1,"div",12),e.YNc(2,M,4,1,"ng-container",10),e.TgZ(3,"span"),e._uU(4),e.qZA(),e.YNc(5,S,2,1,"div",10),e.TgZ(6,"div",13),e._UZ(7,"br"),e._uU(8),e._UZ(9,"ion-icon",14),e.qZA()()()),2&n){const t=s.$implicit,o=e.oxw();e.Q6J("ngClass",e.WLB(6,w,o.getMemberId(o.member_id)===t.msg_from,o.getMemberId(o.member_id)!==t.msg_from)),e.xp6(1),e.Q6J("ngClass",e.kEZ(9,k,"TM"===t.type,"Handler"===t.type,"User"===t.type)),e.xp6(1),e.Q6J("ngIf",o.getMemberId(o.member_id)!==t.msg_from),e.xp6(2),e.Oqu(t.msg),e.xp6(1),e.Q6J("ngIf",o.checkExtension(t.attachment)),e.xp6(3),e.hij("",t.time," ")}}function I(n,s){1&n&&(e.TgZ(0,"div",16),e._uU(1,"someone typing message..."),e.qZA())}function O(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"ion-row",17)(1,"ion-col",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.takePhoto())}),e._UZ(2,"ion-icon",19),e.qZA(),e.TgZ(3,"ion-col",20),e._UZ(4,"ion-textarea",21),e.qZA(),e.TgZ(5,"ion-col",22)(6,"ion-button",23),e._UZ(7,"ion-icon",24),e.qZA()()()}}function T(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col",25)(2,"ion-button",26),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.takePhoto())}),e._uU(3," Select Media "),e._UZ(4,"ion-icon",19),e.qZA()(),e.TgZ(5,"ion-col",25)(6,"ion-button",26),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.usersList())}),e._uU(7," Send Message "),e._UZ(8,"ion-icon",27),e.qZA()()()}}const U=[{path:"",component:(()=>{class n{constructor(t,o,i,g,m,A,J,G,Y){this.pusherService=t,this.navCtrl=o,this.location=i,this.activateRoute=g,this.globalService=m,this.popoverController=A,this.modalController=J,this.router=G,this.chatService=Y,this.messages=[],this.newMsg="",this.chat_name="Loading...",this.profile_image="",this.typing_message=!1,this.page=1,this.msgForm=new c.cw({message:new c.NI("",c.kI.required)})}ngOnInit(){this.groupId=this.activateRoute.snapshot.params.id,this.type=this.activateRoute.snapshot.params.type,this.fromId=this.activateRoute.snapshot.params.fromId,this.pusherService.channel.bind("client-messaging",t=>{this.loadChat(this.groupId)}),this.pusherService.channel.bind("client-typing",t=>{this.typing_message=!0,console.log(t)}),this.pusherService.channel.bind("client-seen",t=>{console.log(t)}),this.msgForm.get("message").valueChanges.subscribe(t=>{this.typingMessage()}),this.loadChat(this.groupId),this.loadUsers(),setInterval(()=>{this.typing_message=!1},3e3)}typingMessage(){const t={to_id:this.groupId,from_id:this.fromId,chat_type:this.type,message:"",source:"app",data_id:this.generateNumber()};"user"===this.type?t.user_id=this.groupId:t.group_id=this.groupId,this.pusherService.typingMessage(t)}loadChat(t){this.chatService.getFetchChatHistory({chat_id:t,user_id:this.fromId,chat_type:this.type,page:"1"}).subscribe(i=>{this.messages=i.history,this.chat_name=i.name,this.profile_image=i.profile_image,this.member_id=this.fromId,this.content.scrollToBottom(300)})}sendMessage(){return(0,l.mG)(this,void 0,void 0,function*(){if(!this.msgForm.valid)return void this.msgForm.markAllAsTouched();const t={to_id:this.groupId,from_id:this.fromId,chat_type:this.type,message:this.msgForm.value.message,source:"web"};"user"===this.type?t.user_id=this.groupId:t.group_id=this.groupId,(yield this.chatService.apiSaveChat(t)).subscribe(o=>{this.msgForm.reset(),this.loadChat(this.groupId),t.data_id=o.msg_id,this.pusherService.sendMessage(t)})})}generateNumber(){return Math.floor(1e7*Math.random())}back(){this.location.back()}checkExtension(t){const o=t.substring(t.lastIndexOf(".")+1,t.length).toString();return"png"===o.toLowerCase()||"jpeg"===o.toLowerCase()||"jpg"===o.toLowerCase()||"gif"===o.toLowerCase()}loadUsers(){const t=localStorage.getItem("ca_user_id");this.chatService.apiGetUsersList({user_id:t}).subscribe(o=>{this.users=o.data})}takePhoto(){return(0,l.mG)(this,void 0,void 0,function*(){this.imgPath="",this.globalService.takePhoto().then(t=>(0,l.mG)(this,void 0,void 0,function*(){this.imgPath=t.imageUrl;const o={to_id:this.groupId,from_id:this.fromId,chat_type:this.type,message:"Attachment",source:"web"};"user"===this.type?o.user_id=this.groupId:o.group_id=this.groupId;const i=new FormData;i.append("message","Attachment"),i.append("to_id",this.groupId),i.append("from_id",this.fromId),i.append("chat_type",this.type),i.append("source","web"),i.append("file",this.imgPath),i.append("user"===this.type?"user_id":"group_id",this.groupId),(yield this.chatService.apiSaveChat2(i)).subscribe(g=>{this.msgForm.reset(),this.loadChat(this.groupId),o.data_id=g.msg_id,this.pusherService.sendMessage(o)})}))})}getMemberId(t){return Number(t)}presentPopover(t,o){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.popoverController.create({component:f,event:t,componentProps:{message:o}});yield i.present();const{role:g}=yield i.onDidDismiss();console.log(`Popover dismissed with role: ${g}`)})}usersList(){return(0,l.mG)(this,void 0,void 0,function*(){this.modalElement=yield this.modalController.create({component:C,backdropDismiss:!0,mode:"ios",id:"datemodal",componentProps:{items:this.users}}),yield this.modalElement.present(),yield this.modalElement.onDidDismiss().then(t=>{console.log(t),"accept"==t?.role&&this.router.navigate(["app/chat/chat-screen/user/"+t.data.id+"/"+t.data.user_id])})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x),e.Y36(r.SH),e.Y36(p.Ye),e.Y36(d.gz),e.Y36(u.U),e.Y36(r.Dh),e.Y36(r.IN),e.Y36(d.F0),e.Y36(y.a))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat-screen"]],viewQuery:function(t,o){if(1&t&&e.Gf(r.W2,5),2&t){let i;e.iGM(i=e.CRH())&&(o.content=i.first)}},decls:15,vars:7,consts:[["mode","md"],[3,"click"],[1,"vertical-center-header"],["src","assets/icon/arrow-left.svg",1,"back-arrow"],[3,"fullscreen"],[2,"position","relative"],["class","message",3,"ngClass",4,"ngFor","ngForOf"],["class","typing-msg",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","ion-align-items-center",4,"ngIf"],[4,"ngIf"],[1,"message",3,"ngClass"],[1,"innerMsg",3,"ngClass"],[1,"time","ion-text-right"],["name","checkmark-done-outline"],["width","250px",3,"src","click"],[1,"typing-msg"],[1,"ion-align-items-center"],["size","1.5",2,"text-align","center",3,"click"],["name","document-attach-outline",1,"attachment-icon"],["size","8.5"],["autoGrow","true","rows","1","maxLength","500","formControlName","message",1,"message-input"],["size","2"],["expand","block","fill","clear","type","submit",1,"msg-btn"],["name","send","slot","icon-only"],["size","6"],["size","full",3,"click"],["name","chatbox-outline"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),e.NdJ("click",function(){return o.back()}),e.TgZ(3,"div",2),e._UZ(4,"ion-icon",3),e._uU(5),e.qZA()()()(),e.TgZ(6,"ion-content",4)(7,"div",5),e.YNc(8,Z,10,13,"div",6),e.qZA()(),e.TgZ(9,"ion-footer"),e.YNc(10,I,2,0,"div",7),e.TgZ(11,"ion-toolbar")(12,"form",8),e.NdJ("ngSubmit",function(){return o.sendMessage()}),e.YNc(13,O,8,0,"ion-row",9),e.YNc(14,T,9,0,"ion-row",10),e.qZA()()()),2&t&&(e.xp6(5),e.hij(" ",o.chat_name," "),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(2),e.Q6J("ngForOf",o.messages),e.xp6(2),e.Q6J("ngIf",o.typing_message),e.xp6(2),e.Q6J("formGroup",o.msgForm),e.xp6(1),e.Q6J("ngIf","user"==o.type),e.xp6(1),e.Q6J("ngIf","group"==o.type))},dependencies:[p.mk,p.sg,p.O5,c._Y,c.JJ,c.JL,r.YG,r.wI,r.W2,r.fr,r.Gu,r.gu,r.Nd,r.g2,r.wd,r.sr,r.j9,c.sg,c.u],styles:[".message-input[_ngcontent-%COMP%]{width:100%;border:1px solid var(--ion-color-medium);border-radius:6px;background:#fff;resize:none;margin-top:0;--padding-start: 8px}.message[_ngcontent-%COMP%]{padding:5px 10px!important;border-radius:10px!important;margin-bottom:4px!important;white-space:pre-wrap}.my-message[_ngcontent-%COMP%]{color:#fff;justify-content:flex-end!important;display:flex!important;flex-direction:row!important}.my-message[_ngcontent-%COMP%]   .innerMsg[_ngcontent-%COMP%]{background:#3b71ca;padding:5px;border-radius:5px}.my-message[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{color:#f4f4f4;float:right;font-size:small}.other-message[_ngcontent-%COMP%]{color:#000;justify-content:flex-start!important;display:flex!important;flex-direction:row!important}.other-message[_ngcontent-%COMP%]   .innerMsg[_ngcontent-%COMP%]{background:#fff;padding:5px;border-radius:5px}.other-message[_ngcontent-%COMP%]   .innerMsg[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:300px;object-fit:cover}.other-message[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{color:#888;float:right;font-size:small}.msg-btn[_ngcontent-%COMP%]{padding:0;margin:0}.attachment-icon[_ngcontent-%COMP%]{font-size:20px;color:#888}.typing-msg[_ngcontent-%COMP%]{color:#000;position:absolute;margin-top:-11px;font-size:10px;margin-left:35%;background:white}ion-button[_ngcontent-%COMP%]{background:#fff;--background-activated: #fff;--background: #fff;--background-focused: #fff;--background-hover: #fff;--color: black;border:1px gray solid}ion-button[_ngcontent-%COMP%]::part(native){border-width:1px;border-color:#8888;text-transform:capitalize;font-family:arial;border-radius:5px}.bg-color-blue[_ngcontent-%COMP%]{background:#0D4DA4!important;color:#fff!important}.bg-color-blue[_ngcontent-%COMP%]   .ion-text-right[_ngcontent-%COMP%]{color:#fff}.bg-color-red[_ngcontent-%COMP%]{background:#E13348!important;color:#fff!important}.bg-color-red[_ngcontent-%COMP%]   .ion-text-right[_ngcontent-%COMP%]{color:#fff}.bg-color-white[_ngcontent-%COMP%]{background:#ddd!important;color:#000!important}.bg-color-white[_ngcontent-%COMP%]   .ion-text-right[_ngcontent-%COMP%]{color:#000}"]}),n})()}];let F=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.Bz.forChild(U),d.Bz]}),n})(),N=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,c.u5,r.Pc,F,c.UX]}),n})()}}]);